{% from "_render_field.html" import render_field, tank_field %}
{% extends "base.html" %}
{% set active_page = "Minimum Gas" %}

{% block head %}
{{ super() }}

<link rel="stylesheet" href="{{ url_for('static', filename='css/min_gas.css') }}">


{% endblock %}

{% block page_content %}


<div class="dive-details">
  <form action="/minimum-gas" method="POST">
    {{ form.csrf_token }}
    <br>
    {{ render_field(form.depth, placeholder='Max. depth', pattern="[0-9]{1,10}",
                      title="Enter only integer numbers") }}
    {{ render_field(form.solve, placeholder='Problem solving time', 
                      pattern="[0-9]{1,10}",
                      title="Enter only integer numbers") }}
    {{ render_field(form.gas) }}
    <div class="form-group row">
      <div class="col-sm-10 offset-sm-4">
        {{ form.submit(class="btn btn-primary") }}
      </div>
    </div>
  </form>
</div>
{% if plan is defined %}
<div class="plan-details">
  <h3>Ascent Plan:</h3>  
  <p>{{ plan[0][0] }}m: 1' donate gas</p>
  <p>{{ plan[0][0] }}m --> {{ plan[1][0] }}m: 9m/min ascent rate</p>
  {% for i in range(1, (plan|length - 2)) %}
    <p> {{ plan[i][0] }}m: 1' </p>
  {% endfor %}
  <p> {{ plan[-1][0] }}m: 1' gas switch</p>
</div>
<div class="tank-details">
  <h4>Minimum Gas: {{ litres }} L</h4>
  <form action="/gas_used" method="POST" role="form">
    {{ tank_form.csrf_token }}
    <p id="litres-field"> {{ tank_form.min_gas_L }}</p>
    <br>
    {{ tank_field(tank_form.tank) }}
    <p id="bar-field"> {{ bar }} bar </p>
  </form>
</div>


{% endif %}


<div class="d3line"></div>


{% endblock %}

{% block scripts %}
{{ super() }}
{% if plan is defined %}
<script>
  var dataset = [{
    depth: parseInt('{{ plan[0][0] }}'),
    time: 0
  }];
</script>
{% for stop in plan %}
<script>
  dataset.push({ depth: parseInt('{{ stop[0] }}'), time: parseInt('{{ stop[1] }}') })
</script>
{% endfor %}
{% endif %}
<script src="https://d3js.org/d3.v5.min.js"></script>
<!-- <script src="http://dimplejs.org/dist/dimple.v2.3.0.min.js"></script> -->
<script src="{{ url_for('static', filename='d3.js') }}"></script>
<script type=text/javascript>

$(function() {
    $('button').click(function() {
        $.ajax({
            url: '/gas_used',
            data: $('form').serialize(),
            type: 'POST',
            success: function(response) {
                var parsed_data = JSON.parse(response);
                $("#bar-field").html(parsed_data.bar + " bar");
                console.log(response);
            },
            error: function(error) {
                console.log(error);
            }
        });
    });
});

</script>
{% endblock %}